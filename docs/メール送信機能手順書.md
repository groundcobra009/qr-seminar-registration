# 同窓会受付完了メール送信機能 - 使い方ガイド

## 概要
このシステムでは、申込者に受付完了メールを自動送信できます。
H列（返信）がFALSEの方に対して、QRコード付きの受付完了メールを送信し、送信後にH列をTRUEに更新します。

## 機能の特徴
- **自動判定**: A列にタイムスタンプがあり、H列がFALSEの行を自動検索
- **個別メール**: B列の氏名を使用した個別メッセージ
- **HTMLメール**: QRコードを直接メール内に画像表示
- **美しいレイアウト**: スタイリング済みのプロフェッショナルなデザイン
- **送信記録**: 送信後に自動でH列をTRUEに更新
- **エラー処理**: 送信失敗時の詳細エラー表示

## 事前準備

### 1. 必要なデータの確認
以下の列にデータが入力されていることを確認してください：

| 列 | 項目 | 例 |
|---|---|---|
| A | タイムスタンプ | 2025/07/14 22:26:07 |
| B | 氏名（フルネーム） | 田中太郎 |
| D | メールアドレス | tanaka@example.com |
| E | トークン | Ats52yp79rk1ov1u |
| F | URL | https://script.google.com/.../exec?token=... |
| G | QRコード | https://api.qrserver.com/v1/create-qr-code/... |
| H | 返信 | FALSE |

### 2. QRコードの生成
メール送信前に必ずQRコードを生成してください：
1. メニュー「📱 QRコード生成」から任意のサイズを選択
2. G列にQRコードURLが生成されることを確認

## メール送信手順

### 手動送信
1. スプレッドシートを開く
2. メニュー「QRコードセミナー受付システム」→「📧 受付完了メール送信」をクリック
3. 送信結果ダイアログで成功・失敗件数を確認

### 送信内容
#### 件名
```
[同窓会] 受付完了のお知らせ
```

#### メール本文
```
{氏名}様

この度は同窓会にお申込みいただき、ありがとうございます。
受付が完了いたしました。

当日は下記のQRコードをお持ちください。
受付でこちらのQRコードをご提示いただくとスムーズに入場できます。

※QRコードは当日まで大切に保管してください。
※万が一QRコードを紛失された場合は、受付でお名前をお伝えください。

ご不明な点がございましたら、お気軽にお問い合わせください。
当日お会いできることを楽しみにしております。

---
同窓会実行委員会
```

#### メール形式
- **HTML形式**: QRコードが直接メール内に表示
- **テキスト形式**: HTMLが表示できない環境用の代替版
- **スタイリング**: プロフェッショナルなデザインとレイアウト
- **QRコード**: 200x200サイズで鮮明に表示

## 自動送信設定（トリガー）

### トリガー設定手順
1. Google Apps Scriptエディタを開く
2. 左メニューの「トリガー」をクリック
3. 「トリガーを追加」をクリック
4. 以下の設定を行う：
   - **実行する関数**: `sendReceptionEmails`
   - **実行するデプロイ**: Head
   - **イベントのソース**: 時間主導型
   - **時間ベースのトリガーのタイプ**: 分ベースのタイマー
   - **時間の間隔**: 1分おき（または希望の間隔）

### 自動送信の注意点
- 一度送信されたメール（H列=TRUE）は再送信されません
- 新しく追加された行（H列=FALSE）のみが送信対象になります
- トリガーは必要に応じて停止・削除できます

## エラー対処法

### よくあるエラーと対処法

#### 1. 「氏名またはメールアドレスが未入力です」
- **原因**: B列（氏名）またはD列（メールアドレス）が空白
- **対処**: 該当する列にデータを入力してください

#### 2. 「QRコードが生成されていません」
- **原因**: G列（QRコード）が空白または「CellImage」という値
- **対処**: 
  1. 「🔄 QRコード再生成」を実行してください
  2. または「📱 QRコード生成」から任意のサイズを選択

#### 3. 「シートが見つかりません」
- **原因**: システム設定が未完了
- **対処**: 「📋 システム設定」で正しいシートを設定してください

#### 4. Gmail送信エラー
- **原因**: Gmail APIの権限不足または送信制限
- **対処**: 
  - 初回実行時に権限承認を行ってください
  - Gmailの1日送信制限（100通/日）を超えていないか確認

## 送信状況の確認

### H列（返信）の状態確認
- **FALSE**: 未送信
- **TRUE**: 送信済み

### 送信履歴の確認
1. Google Apps Scriptエディタのログを確認
2. 実行トランスクリプトで詳細なログを確認

## 運用のポイント

### 効率的な運用方法
1. **事前準備**: 申込み受付後にまとめてQRコード生成
2. **確認送信**: 少数でテスト送信してから本格運用
3. **定期実行**: トリガーで自動送信設定
4. **状況監視**: 定期的にH列の状況を確認

### セキュリティ対策
- QRコードは第三者に知られないよう注意
- メールアドレスの入力ミスがないか事前確認
- 送信前にデータのバックアップを推奨

## よくある質問

### Q: 一度送信したメールを再送信したい
A: H列をFALSEに戻してから再度送信を実行してください

### Q: メールの文面を変更したい
A: `sendReceptionEmail`関数内の`body`変数を編集してください

### Q: QRコードのサイズを変更したい
A: 「📱 QRコード生成」メニューから希望のサイズを選択してください

### Q: 送信者名を変更したい
A: GmailApp.sendEmailの第4パラメータに`{name: "送信者名"}`を追加してください

---

**注意**: このシステムはGmail APIを使用しています。初回実行時にはGoogleアカウントでの認証が必要です。 