# QRコードセミナー受付システム セットアップ手順書

## 🚀 **実装完了後のセットアップ手順**

### **Step 1: HTMLファイルの追加**

1. **Google Apps Script エディタで以下を実行**：
   ```
   左側の「ファイル」→「+」→「HTML」をクリック
   ```

2. **ファイル名を設定**：
   - ファイル名：`settings`
   - 提供された settings.html の内容をコピー&ペースト

3. **保存**：
   - Ctrl+S (または Cmd+S) で保存

### **Step 2: Webアプリとしてデプロイ**

1. **Google Apps Script エディタで以下を実行**：
   ```
   右上の「デプロイ」→「新しいデプロイ」をクリック
   ```

2. **デプロイ設定**：
   - **種類**: 「ウェブアプリ」を選択
   - **説明**: 「QRコードセミナー受付システム」
   - **実行者**: 「自分」
   - **アクセスできるユーザー**: 「全員」
   - 「デプロイ」をクリック

3. **重要**: デプロイ後に表示される **ウェブアプリURL** をコピーして保存
   ```
   例: https://script.google.com/macros/s/AKfycby.../exec
   ```

### **Step 3: システム設定**

1. **スプレッドシートを開く**
2. **メニューバーの「QRコードセミナー受付システム」→「システム設定」**
3. **スプレッドシートIDを入力**：
   - URLの `/d/` と `/edit` の間の部分をコピー
   - 例: `1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms`
4. **シート名を入力** (デフォルト: シート1)
5. **「保存」をクリック**

### **Step 4: URL一括生成の実行**

1. **メニューから実行**：
   ```
   「QRコードセミナー受付システム」→「URL一括生成」
   ```

2. **確認**：
   - スプレッドシートのF列にURLが生成されることを確認
   - URL形式: `https://script.google.com/macros/s/{SCRIPT_ID}/exec?token={トークン}`

### **Step 5: テスト実行**

1. **テスト用のURLアクセス**：
   - 生成されたURLの1つをブラウザで開く
   - 受付完了画面が表示されることを確認
   - スプレッドシートのI列「受付」がTRUEになることを確認

2. **重複受付テスト**：
   - 同じURLに再度アクセス
   - 「既に受付済み」エラーが表示されることを確認

3. **受付状況確認**：
   - メニューから「受付状況確認」を実行
   - 受付完了人数と受付率が表示されることを確認

### **Step 6: QRコード生成（オプション）**

#### **方法1: メニューから自動生成**
```
「QRコードセミナー受付システム」→「QRコード生成」
```
- G列に自動でQRコード画像が生成される
- 生成件数が表示される

#### **方法2: 手動で数式入力**
G列に以下の数式を入力：
```
=IMAGE("https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" & ENCODEURL(F2))
```

#### **QRコードのカスタマイズオプション**
api.qrserver.comでは以下のオプションが利用可能：

**サイズ変更例**:
```
=IMAGE("https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=" & ENCODEURL(F2))
```

**エラー訂正レベル付き**:
```
=IMAGE("https://api.qrserver.com/v1/create-qr-code/?size=200x200&ecc=M&data=" & ENCODEURL(F2))
```

**利用可能なオプション**:
- `size`: QRコードサイズ (例: 150x150, 200x200, 300x300)
- `ecc`: エラー訂正レベル (L=低, M=中, Q=高, H=最高)
- `format`: 画像形式 (png, gif, jpeg, svg)
- `color`: 前景色 (例: &color=000000)
- `bgcolor`: 背景色 (例: &bgcolor=ffffff)

## 🔧 **運用時の管理機能**

### **📊 受付状況の確認**
```
メニュー：「QRコードセミナー受付システム」→「受付状況確認」
```
- 受付完了人数と受付率をダイアログで表示
- リアルタイムでの状況確認が可能

### **🔍 システム健全性チェック**
```
メニュー：「QRコードセミナー受付システム」→「システムチェック」
```
- データ行数の確認
- 重複トークンの検出と表示
- システム全体の健全性確認

### **📋 システム設定の変更**
```
メニュー：「QRコードセミナー受付システム」→「システム設定」
```
- スプレッドシートIDの変更
- シート名の変更
- 現在の設定の確認

### **📖 使い方ガイド**
```
メニュー：「QRコードセミナー受付システム」→「使い方ガイド」
```
- システムの使い方を表示
- 主要機能の説明

## 📋 **実際の運用フロー**

### **事前準備**
1. ✅ スプレッドシートの準備
2. ✅ GASコードの実装・デプロイ
3. ✅ URL一括生成の実行
4. ✅ QRコード生成（必要に応じて）
5. ✅ テスト実行

### **セミナー当日**
1. **参加者への案内**：
   - QRコードまたはURLを参加者に配布
   - 受付方法の説明

2. **受付管理**：
   - リアルタイムでの受付状況確認
   - 問題発生時の対応

3. **トラブルシューティング**：
   - エラー画面が表示された場合の手動受付
   - システム監視

## 🚨 **トラブルシューティング**

### **よくある問題と解決方法**

#### **1. URLアクセス時にエラーが発生**
**原因**: 権限設定またはデプロイ設定の問題
**解決策**:
- デプロイ時の「アクセスできるユーザー」が「全員」になっているか確認
- 新しいデプロイを作成してURLを更新

#### **2. スプレッドシートにアクセスできない**
**原因**: スプレッドシートIDの設定問題
**解決策**:
- `SHEET_ID` の設定を確認
- スプレッドシートとGASが同じGoogleアカウントか確認

#### **3. URLが生成されない**
**原因**: E列のトークンが空またはF列に既に値がある
**解決策**:
- E列にトークンが入力されているか確認
- F列を空にしてから再実行

#### **4. 受付状態が更新されない**
**原因**: 列の設定またはデータ形式の問題
**解決策**:
- `COLUMNS` の設定を確認
- スプレッドシートの列順序を確認

## 🔒 **セキュリティ考慮事項**

### **実装済みセキュリティ機能**
- ✅ トークンベースの認証
- ✅ 重複受付防止
- ✅ 無効なトークンへの対応
- ✅ エラーハンドリング

### **追加推奨事項**
- 定期的なアクセスログ確認
- トークンの複雑さ向上
- バックアップの定期実行

## 📊 **監視・ログ**

### **実行ログの確認**
1. GASエディタの「実行内容の記録」を確認
2. 受付ログの定期確認
3. エラーログの監視

### **スプレッドシートの監視**
- 受付状況の定期確認
- データの整合性チェック
- バックアップの実行

## 🎯 **運用開始チェックリスト**

### **デプロイ前**
- [ ] コードの実装完了
- [ ] スプレッドシートの準備完了
- [ ] 列の設定確認
- [ ] テストデータでの動作確認

### **デプロイ後**
- [ ] Webアプリのデプロイ完了
- [ ] URLの一括生成完了
- [ ] 実際のデータでのテスト完了
- [ ] QRコード生成完了（必要に応じて）

### **運用開始**
- [ ] 参加者への案内完了
- [ ] 管理者向け操作手順の共有
- [ ] トラブル時の連絡体制確立
- [ ] バックアップ体制の確立

---

## 📞 **サポート**

システムに関する問題や質問がある場合は、以下の手順で対応してください：

1. **まずはログを確認**
2. **トラブルシューティングガイドを参照**
3. **必要に応じて手動での受付処理**

---

**🎉 セットアップ完了！**
これでQRコードセミナー受付システムの運用開始準備が整いました。 