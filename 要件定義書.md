# QRコードセミナー受付システム 要件定義書

## 1. システム概要

### 1.1 目的
QRコードを使用したセミナー受付システムの構築。参加者が個別のURLにアクセスすることで、自動的に受付状態を更新する。

### 1.2 システム構成
- Google Apps Script (GAS)
- Google スプレッドシート
- Webアプリケーション（デプロイエンドポイント）

## 2. データ構造

### 2.1 スプレッドシート列構成
| 列 | 項目名 | データ型 | 説明 |
|---|--------|----------|------|
| A | タイムスタンプ | 日時 | 申込日時 |
| B | 氏名（フルネーム） | 文字列 | 参加者氏名 |
| C | 卒業年度 | 数値 | 例：2001年 |
| D | メールアドレス | 文字列 | 連絡先 |
| E | トークン | 文字列 | 一意識別子（例：Ats52yp79rk1ov1u） |
| F | URL | 文字列 | 受付用URL（自動生成） |
| G | QR | 文字列 | QRコード関連 |
| H | 返信 | 真偽値 | 返信状態 |
| I | 受付 | 真偽値 | 受付完了状態 |

### 2.2 サンプルデータ
```
タイムスタンプ | 氏名 | 卒業年度 | メール | トークン | URL | QR | 返信 | 受付
             |      |          |        | Ats52yp79rk1ov1u |     |    | FALSE | FALSE
             |      |          |        | Aoaozpl0yfmctpcd |     |    | FALSE | FALSE
             |      |          |        | Amr4n8xuy4xxgtb5 |     |    | FALSE | FALSE
             |      |          |        | A7radcnoq5lqjq43 |     |    | FALSE | FALSE
```

## 3. 機能要件

### 3.1 URL生成機能
**機能ID**: F001
**概要**: F列に受付用URLを自動生成する

**詳細**:
- デプロイしたWebアプリのエンドポイントURL + E列のトークンを組み合わせ
- URL形式: `https://script.google.com/macros/s/{SCRIPT_ID}/exec?token={トークン}`
- 既存データに対して一括生成機能
- 新規データ追加時の自動生成機能

### 3.2 受付処理機能
**機能ID**: F002
**概要**: 生成されたURLにアクセスされた際の受付状態更新

**詳細**:
- URLパラメータからトークンを取得
- トークンに該当する行のI列「受付」をTRUEに更新
- 受付完了のレスポンス画面表示
- エラーハンドリング（無効なトークン等）

### 3.3 管理機能
**機能ID**: F003
**概要**: システム管理者向けの操作機能

**詳細**:
- URL一括生成ボタン
- 受付状況確認機能
- ログ機能（アクセス履歴）

## 4. 非機能要件

### 4.1 セキュリティ
- トークンの一意性保証
- 不正アクセス防止
- 重複受付防止

### 4.2 パフォーマンス
- 同時アクセス対応
- レスポンス時間：3秒以内

### 4.3 可用性
- 24時間365日稼働
- Google Apps Scriptの制限内での運用

## 5. 技術仕様

### 5.1 開発言語・環境
- Google Apps Script (JavaScript)
- Google スプレッドシート
- HTML/CSS（レスポンス画面）

### 5.2 外部連携
- Google スプレッドシート API
- Web Apps（GAS デプロイ機能）

## 6. 画面仕様

### 6.1 受付完了画面
- 受付完了メッセージ
- 参加者名表示
- セミナー詳細情報

### 6.2 エラー画面
- 無効なトークンエラー
- 既に受付済みエラー
- システムエラー

## 7. 運用要件

### 7.1 データバックアップ
- スプレッドシートの定期バックアップ
- ログデータの保管

### 7.2 メンテナンス
- 定期的なトークン重複チェック
- システム動作確認

## 8. 実装手順

### Phase 1: 基盤構築
1. スプレッドシートの準備
2. GASプロジェクトの設定
3. HTMLファイルの追加（settings.html）
4. Webアプリのデプロイ

### Phase 2: システム設定
1. onOpen関数によるメニューの追加
2. システム設定画面の実装
3. PropertiesServiceによる設定保存

### Phase 3: URL生成機能
1. URL生成ロジックの実装
2. メニューからの一括生成機能
3. UI通知機能の実装

### Phase 4: 受付処理機能
1. doGet関数の実装
2. トークン検証ロジック
3. 受付状態更新機能
4. レスポンス画面の作成

### Phase 5: 管理機能
1. 受付状況確認機能
2. システムチェック機能
3. QRコード生成機能
4. ヘルプ機能

### Phase 6: テスト・本番運用
1. 各機能の単体テスト
2. 統合テスト
3. 最終デプロイ
4. 運用開始とモニタリング

## 9. 制約事項

- Google Apps Scriptの実行時間制限（6分）
- 同時実行数制限
- スプレッドシートの行数制限

## 10. リスク・課題

### 10.1 技術的リスク
- GASサービス停止
- スプレッドシート破損

### 10.2 運用リスク
- トークン漏洩
- 不正アクセス

### 10.3 対策
- 定期バックアップの実施
- アクセスログの監視
- セキュリティ対策の強化 